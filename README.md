# Malware Detection

## Introduction

In this project, I am going to install Yara in a Kali Linux machine and use it as malware detection by writing Yara Rules. Also, show how to apply rules if there is malicious file, how to extract information and see the matched between rules and the files. 
Furthermore, show how to analyze malwares and obtain useful information such as network communication, persistent mechanisms and so on from some websites. Details as below:

## Install Yara in Kali Linux
![Install Yara in Kali Linux](https://i.imgur.com/moW8iaK.png)

Then I extracted the sample malware named “njRAT-v0.6.4.zip ” with the below commands:

![Install Yara in Kali Linux](https://i.imgur.com/Pj25Cm0.png)

Once I unzipped the given file, saw that all the files inside it as shown in the picture below:

![Install Yara in Kali Linux](https://i.imgur.com/zNh1kAJ.png)

After that, with the command “strings” I can check which APIs this malware used :

![Install Yara in Kali Linux](https://i.imgur.com/mubdq9a.png)

Then it will help us to use them for writing  Yara rules and put these API-name in string part, and in the condition part if this rule detects 10 of them and raise errors.

![Install Yara in Kali Linux](https://i.imgur.com/WivvzRs.png)

After running  Yara rule, the name of the rule and file which is malware was printed. This shows, at least 10 out of 14 strings (function calls) are used in the malware. 

![Install Yara in Kali Linux](https://i.imgur.com/GFoCHII.png)

## Run Yara on malware samples 
As below I have a file which is contained a bunch of different malware samples and some Yara rules. like the first part,  againI  used unzip command (7za ) to extract the file. In the figure below you can see them all in our directory:

![Run Yara on malware samples](https://i.imgur.com/uxqGiKc.png)

Then need to run each Yara rule on the “malwaresamples” file and see what is the result of each yara command.
Below pictures shows all of them :

![Run Yara on malware samples](https://i.imgur.com/dtBJWIe.png)

On the other hand, once I check the inside of “malwaresamples” by “l” command I saw all these results are in it as below red lines :

![Run Yara on malware samples](https://i.imgur.com/9SHHcWe.png)

## Analze the malware sample

There is a site named https://www.virustotal.com. We can uploaded the file to this site to see if it shows any details about the malware. 
after unzipping the file

![Analyze the malware sample](https://i.imgur.com/koA4Iu3.png)

Tthe site shows that 56 security vendors and 6 sandboxes flagged this file as malicious.

![Analyze the malware sample](https://i.imgur.com/v8H9jGP.png)

The below image shows, this malware is a Trojan horse for the Chrome browser.

![Analyze the malware sample](https://i.imgur.com/PrqP4SU.png)


## Hashes - md5, sha1sum, sha256sum

with creating hash values of the malware using md5, sha1 and sha2 algorithms, I could compare them with the provided values from the website.

![Hashes,md5,sha1sum,sha256sum](https://i.imgur.com/xXfSNu8.png)

The figure below shows that hash values are the same and I conclude that the malware consider is the same as that considered by the website.

![Hashes,md5,sha1sum,sha256sum](https://i.imgur.com/QLp3DXH.png)


## Yara rule

For yara rules, we checked in “Malpedia” site and get the rule for this malware from there. Should mentioned that the other name of this malware is “Proteus”

![Yara rule](https://i.imgur.com/S8E5o0M.png)

As below, I have downloaded this rule and extracted it as well. The name of the rule is win_proteus_auto.

![Yara rule](https://i.imgur.com/Zg5DP62.png)

![Yara rule](https://i.imgur.com/cN6vzrB.png)

![Yara rule](https://i.imgur.com/9ZZEW7l.png)

## Research on suspicious activities

Proteus malware is an example of a cyber threat which is multi-functional menace:

Proteus steels cryptocurrency

According to Bleeping Computer, Proteus capable of mining fo cryptocurrency by using SHA256 miner, CPUMiner and ZCashMiner, to steal Bitcoin, Litecoin, Zcash, and so on.... 

Proteus turns the computer into a SOCKS proxy

Proteus can enable the computer act as a socket secure proxy which can relays traffic between a client and a server for any type of network protocol. So that any malicious traffic can pass through an infected system. So that it will change your endpoints to an open door for cybercriminals. So that any other types of malwares can be downloaded and executed easily. 

Proteus verifies stolen credentials

One of the most interesting and useful purposes of this malware is testing the validity of stolen login credentials.it is typically used by e-commerce sites. 

Proteus logs keystrokes

Proteus is able to steal login credentials, verify them, use them to extract PII and then once it needed, route that PII to a remote client. It means it can work as a stealing machine.

## Conclusion

In this project, I learned how to analyze malwares and obtain useful information such as network communication, persistent mechanisms and so on from some websites 
